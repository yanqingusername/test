<!--pages/orderDetail/orderDetail.wxml-->
<cu-custom isBack="{{true}}" bgColor="bg-white">
  <view slot="backText"></view>
  <view slot="content">工单详情</view>
</cu-custom>
<view style="background-color:#F5F5F5">
  <view style="height:800rpx;position:relative;">
    <view class="upblue"></view>
    <view class="medWhite">
      <view class="medWhiteView">
        <view class="P5 app_flex" style="width:90%;height:auto;">
          <view class='P5_2 app_font' style="width:100%;height:auto;text-align:left;font-size:40rpx;font-weight:500" name="company_name" value="{{company_name}}">{{info.company_name}}</view>
        </view>
        <view class="medWhiteText">
          {{info.name}}　{{info.phone}}
          <image class="img_phone" bindtap="phoneCall" src="../../image/iphone.png" mode="aspectFit" />
        </view>
        <view class="medWhiteText" >
          {{info.address}}{{info.locationName}}
        </view>
        <image bindtap='autoGetLocation' src="../../image/position.png" mode="aspectFit" class="img_position"/>
      </view> 
    </view>
    <!--服务情况-->
      <block wx:if="{{status>0}}"> 
        <view style="height:50rpx"></view>
        <view class="medWhite">
          <view class="medWhiteView">
            <!--服务记录-->
            <view class="P5" style="font-size:40rpx;font-weight:400;color:#333333;margin-top: 5%">服务记录</view>
            <view class="P5 app_flex" style="width:90%;height:auto;">
              <view class="P5_1 app_font" style="height:auto;width: 22%;min-height:80rpx;color:#333333;">服务情况</view>
              <block wx:if="{{status == 1}}">
                <view class='P5_2 app_font' style="height:13vh;width: 78%;">
                  <textarea class='textarea' minlength="0" fixed="true" maxlength="300" bindinput="bindprocessing_feedback" placeholder="请详细描述服务情况"
                    style="height:13vh;width: 100%;text-align:left;padding-left:1%;margin-top:6px;"
                    name="processing_feedback" value="{{processing_feedback}}">
                  </textarea>
                </view>
              </block>
              <block wx:if="{{status != 1}}">
                <view class='P5_2 app_font' 
                  style="height:100%;text-overflow:ellipsis;word-wrap:break-word;min-height:80rpx;width:78%"> {{info.processing_feedback}}
                </view>
              </block>
            </view>
            <view class="P5 app_flex" style="height: auto;">
              <view class="P5_1 app_font" style="height:auto;width: 22%;min-height:80rpx;color:#333333;">现场拍照</view>
              <block wx:if="{{status != 1}}"> <!--不为已接单状态，只显示图片，不提供图片增删功能-->
                <block wx:if="{{scene_arr.length!=0}}">
                  <view class="img_box">
                    <view class="img_item" wx:for="{{scene_arr}}" wx:for-item="item">
                      <image bindtap="previewScene" data-src="{{item}}" class="img_item_i" data-index='{{index}}'
                        src="{{item}}" mode="aspectFill"></image>
                    </view>
                  </view>
                </block>
              </block>
              <block wx:if="{{status==1}}">  <!--工单状态 0 待处理 1处理中 2已完成待评价 3已完成已评价 4取消 -->
                <view class="img_box">
                  <block wx:if="{{scene_arr.length!=0}}">
                    <view class="img_item" wx:for="{{scene_arr}}" wx:for-item="item">
                      <image bindtap="previewScene" data-src="{{item}}" class="img_item_i" data-index='{{index}}' src="{{item}}"
                        mode="aspectFill"></image>
                      <block ><!--wx:if="{{status==1}}"-->
                        <image bindtap="delScene" data-index="{{index}}" src="../../image/deleteTest.png" class="closeImv"></image>
                      </block>
                    </view>
                  </block>
                  <block ><!--wx:if="{{status>0&&status<2}}"-->
                    <block wx:if="{{scene_arr.length<9}}">
                      <view class="img_item" bindtap="upScene" style=" display: flex;justify-content: center;align-items: center;">
                        <image  class="add_icon"
                          style="width:30%;height:30%;display:flex;justify-content:center;align-item:center" 
                          mode="aspectFill" src="../../image/add.png"></image>
                      </view>
                    </block>
                  </block>
                </view>
              </block>
            </view>
            <!-- 客户评价
            <block wx:if="{{status == 3}}">
              <view class="P5 app_flex" style="width:90%;height:auto;margin-top: 1%;">
                <view class="P5_1 app_font" style="height:auto;width: 20%;">客户评价</view>
                <view class='P5_2 app_font' 
                    style="height:auto;text-overflow:ellipsis;word-wrap:break-word;min-height:80rpx;width:80%"> {{info.customer_reviews}}</view>
              </view>
              <view class="P5 app_flex" style="height: auto;">
                <view class="P5_1 app_font" style="width:100%">
                  图片评价
                </view>
                <view class="img_box">
                  <block wx:if="{{info.reviews_img.length!=0}}">
                    <view class="img_item" wx:for="{{info.reviews_img}}" wx:for-item="item">
                      <image bindtap="previewImgTwo" data-src="{{item}}" class="img_item_i" data-index='{{index}}'
                        src="{{item}}" mode="aspectFill"></image>
                    </view>
                  </block>
                </view>
              </view>
            </block> -->  
          </view>
        </view>
      </block>
    <view style="height:50rpx"></view>
    <view class="medWhite">
      <view class="medWhiteView">
        <view class="P5" style="font-size:40rpx;font-weight:400;color:#333333;margin-top: 5%">服务信息</view>
        <view class="P5 app_flex" >
          <view class="P5_1 app_font" style="margin-top: 5%;">服务类型</view>
          <view class='P5_2 app_font' style="margin-top: 5%;" name="order_num" value="{{info.type}}">{{service_type}}</view>
        </view>
        <view wx:if="{{type != 2}}" class="P5 app_flex" >
          <view class="P5_1 app_font">预约时间</view>
          <view class='P5_2 app_font' name="order_num" value="{{info.time}}">{{info.time}}</view>
        </view>
        <view wx:if="{{type != 4}}"  class="P5 app_flex" >
          <view class="P5_1 app_font">仪器类型</view>
          <view class='P5_2 app_font' name="order_num" value="{{info.repair_type}}">{{info.repair_type}}</view>
        </view>
        <view wx:if="{{type == 4}}"  class="P5 app_flex" >
          <view class="P5_1 app_font">试剂类型</view>
          <view class='P5_2 app_font' name="order_num" value="{{info.reagent_name}}">{{info.reagent_name}}</view>
        </view>
        <view wx:if="{{type != 4}}" class="P5 app_flex" style="height:auto;">
          <view class="P5_1 app_font" style="height:auto;width: 30%;">SN号</view>
          <view class='P5_2 app_font' style="height:auto;width: 70%;">
            <view wx:if="{{info.instrument_SN.length == 1}}">
              <view >{{info.instrument_SN[0]}}</view>
            </view>
            <view wx:if="{{info.instrument_SN.length > 1}}">
              <view wx:if="{{show_flag1}}">{{info.instrument_SN[0]}}</view>
              <view wx:if="{{show_flag1}}" style="color:#307FF5" bindtap="showAll">显示全部</view>
              <block wx:if="{{show_flag2}}" wx:for="{{info.instrument_SN}}">
                <view>{{item}}</view>
              </block>
            </view>
          </view>
        </view>
        <view wx:if="{{type == 1 || type == 2 || type == 5}}" class="P5 app_flex" style="height:auto;">
          <view class="P5_1 app_font" style="height:auto;width: 30%;min-height:80rpx;">问题描述</view>
          <view class='P5_2 app_font' style="height:100%;width: 70%;text-overflow:ellipsis;word-wrap:break-word;min-height:80rpx;" name="order_num" value="{{info.question_desc}}"> {{info.question_desc}}</view>
        </view>
        <view wx:if="{{type == 1 || type == 2 || type == 5}}" class="P5 app_flex" style="height:auto;">
          <view class="P5_1 app_font" style="width:100%">
              图片描述
          </view>
          <block > <!--不为已接单状态，只显示图片，不提供图片增删功能-->
            <block wx:if="{{img_arr.length!=0}}">
              <view class="img_box">
                <view class="img_item" wx:for="{{img_arr}}" wx:for-item="item">
                  <image bindtap="previewImg" data-src="{{item}}" class="img_item_i" data-index='{{index}}'
                    src="{{item}}" mode="aspectFill"></image>
                </view>
              </view>
            </block>
          </block>
         </view> 
      </view> 
    </view>
    <view style="height:50rpx"></view>
    <view class="medWhite">
      <view class="medWhiteView">
        <view class="P5" style="font-size:40rpx;font-weight:400;color:#333333;margin-top: 5%">工单信息</view>
        <view class="P5 app_flex" style="margin-top: 3%;">
          <view class="P5_1 app_font">工单编号</view>
          <view class='P5_2 app_font' style="width:55%" name="order_num" value="{{order_num}}">{{info.order_num}}</view>
          <view style="color:#307FF5;height:65rpx;margin-left:10rpx;" bindtap="bindCopy">复制</view>
        </view>
        <view class="P5 app_flex">
          <view class="P5_1 app_font">创建时间</view>
          <view class='P5_2 app_font' name="order_num" value="{{info.createTime}}">{{info.createTime}}</view>
        </view>
        <view wx:if="{{status == 2}}" class="P5 app_flex">
          <view class="P5_1 app_font">完成时间</view>
          <view class='P5_2 app_font' name="order_num" value="{{info.processingTime}}">{{info.processingTime}}</view>
        </view>
      </view>
    </view>
    <view style="height:150rpx"></view>

  </view>
</view>
<!--接单派单-->
<view wx:if="{{status==0}}" style="height: 12%;width:100%;bottom:0%;margin-top:10%;z-index: 999;position:fixed;background-color:#fff">
  <view wx:if="{{role==1||(role==0&&creator_id==userInfoID)}}" class="cancel_bottom" bindtap="cancelOrder">取消工单</view>
  <button class='button-bottom_2'  bindtap="accept" disabled="{{acceptState}}">立即接单</button>
  <view wx:if="{{role==1}}" style="margin-bottom:10%;margin-top:10%">
    <picker bindchange="onObjArrayPickerChange" value="{{supportList[rangekey].value}}" range-key="{{'name'}}"
    range="{{supportList}}">
      <button class='button-bottom_1' style='width:500rpx;' disabled="{{acceptState}}">派单</button>
    </picker>
  </view>
</view>
<!--保存提交-->
<view style="width:100%;position:fixed;bottom:0%;display:flex;justify-content:center;height: 15%;background-color:#fff;z-index: 999;"
  wx:if="{{status==1}}">
  <button class='button-bottom_3' bindtap="formSubmitSave" data-value="1">保存</button>
  <button class='button-bottom_4' bindtap="formSubmit" data-value="2" >完成服务</button>
</view>